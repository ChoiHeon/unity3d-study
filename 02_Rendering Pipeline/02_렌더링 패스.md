# 렌더링 패스 (Rendering Paths)

### 렌더링 패스

* 유니티는 다양한 렌더링 패스를 지원하며 각각 빛과 그림자에 대해 다른 특징을 가집니다.
* 따라서 사용자는 게임의 컨텐츠나 플랫폼, 하드웨어 등 상황에 맞는 패스를 선택해야 합니다.
* Player Settings이나 Camera 마다 패스를 설정할 수 있습니다.
* 만약 설정한 패스를 그래픽 카드에서 이용할 수 없을 경우, 자동으로 하위 패스를 사용합니다.
  * 디퍼드 라이팅 불가 --> 포워드 렌더링 선택
* 아래는 동적 라이팅을 위한 3가지 주요 기법(패스)입니다.

### 포워드 렌더링

* 싱글 패스 렌더링

  * 오브젝트가 특정 라이트에 영향을 받지 않아도 라이트 연산

  * 화면에 렌더링 되지 않는 면(culling)도 셰이딩(그림자) 연산을 해야 합니다.

  * 멀티 라이트 상황에서 관리가 어렵습니다.

  * 그림자와의 통합이 어렵습니다.

    ex) 1억 개 오브젝트 & 50개 라이팅이 있을 때
    	foreach 오브젝트:
    		foreach 라이트:
    			프레임버퍼 = light_model(오브젝트, 라이트);
    	--> 계산량 = 1억 * 50

* 멀티 패스 렌더링

  * 화면에 렌더링 되지 않는 면(culling)도 셰이팅 연산을 해야 합니다.

  * 오브젝트와 영향을 주지 않는 라이트의 연산을 하지 않습니다. (싱글 패스와의 차이점)

    * 정확히는 영향을 주는 빛들 중 가장 밝은 몇몇 빛들에 대해서 전체 픽셀 라이팅 모드로 렌더링합니다. (per-pixel)
      * 픽셀 라이팅으로 항상 선택되는 빛은 (1) Important로 설정되거나 (2) 가장 밝은 지향성 라이트입니다.
      * 만약 픽셀 라이팅으로 선택된 빛의 개수가 설정된 Pixel Light Count 보다 적다면, 밝기를 줄이기 위해 더 많은 빛을 픽셀 라이팅으로 선택합니다.
    * 다음으로 최대 4개의 포인트 라이트가 정점마다 계산됩니다. (per-vertex)
    * 나머지는 SH(Spherical Harmonics)로 계산합니다.
    * per-pixel, per-vertex, SH 그룹은 겹치는 부분이 있을 수 있습니다.
    * SH는 매우 빠른 대신 CPU와 GPU의 비용이 매우 매우 적습니다.

  * 기본적으로 하나의 패스에서 1개의 픽셀 지향성 라이팅과 나머지 빛이 SH로 계산됩니다.

  * 이후 1패스 당 하나의 픽셀 라이팅이 렌더링됩니다.

  * 배치 카운트가 높습니다. (1 / 오브젝트 수 / 라이팅 수)

    ex) 1억 개 오브젝트 & 50개 라이팅이 있을 때
    	--> 계산량 = 50 * (빛에 영향받는 오브젝트 수)

[포워드 렌더링 매뉴얼](https://docs.unity3d.com/kr/530/Manual/RenderTech-ForwardRendering.html)

### 디퍼드 렌더링

* 배치가 간단해지며 엔진에서 관리가 쉬워집니다.
* 일반적인 그림자 테크닉들과 통합이 쉽습니다.
* 일종의 포스트 프로세싱처럼 수행됩니다.
  * 3D 계산을 2D 계산으로 변환시킵니다.
* 라이팅 계산을 먼저 하지 않고, 미루었다가(deferred) 수행합니다.
  * 오브젝트는 라이팅 계산 없이 속성만 렌더링합니다.
  * 화면에 실제로 렌더링되는 픽셀만 라이팅 계산을 수행합니다.
  * 라이팅 계산이 오브젝트의 수와 상관이 없습니다. (완전한 O(1) 복잡도)
* 수많은 작은 동적 라이팅의 사용이 가능합니다.

